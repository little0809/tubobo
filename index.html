
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Para Ti Amor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
    <link rel="stylesheet" href="dark-mode.css">
</head>
<body>
         <div class="music-control">
        <button class="music-btn" id="musicBtn" aria-label="Toggle music">
            <i class="fas fa-play" id="playIcon"></i>
            <i class="fas fa-pause" id="pauseIcon" style="display: none;"></i>
        </button>
        <div class="volume-control" id="volumeControl">
            <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5" aria-label="Volume control">
        </div>
    </div>
    <audio id="backgroundMusic" loop preload="auto">
        <source src="musica.mp3" type="audio/mpeg">
        Tu navegador no soporta el elemento de audio.
    </audio>
        <div class="background-canvas"></div>
    <div class="particle-system" id="particleSystem"></div>
    
    <section class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">Flores Amarillas</h1>
            <p class="hero-subtitle">Donde el tiempo se detiene y el amor florece eternamente</p>
            <div class="hero-date">Para ti, con todo mi coraz√≥n üíõ</div>
        </div>
        <div class="scroll-indicator">
            <span>Descubre</span>
            <div class="scroll-arrow"></div>
        </div>
    </section>
    
    <section class="main-section">
        <div class="container">
            <div class="section-header fade-in">
                <h2 class="section-title">Un Momento Eterno</h2>
                <p class="section-description">En el silencio dorado de este d√≠a especial, cada p√©talo susurra historias de amor que trascienden el tiempo.</p>
            </div>
            
            <div class="premium-card fade-in">
                <p>Mi querido amor, en este d√≠a donde las flores amarillas danzan al ritmo de nuestros corazones, quiero regalarte algo m√°s que p√©talos: quiero entregarte cada latido, cada suspiro, cada momento que hemos construido juntos.</p>
            </div>
        </div>
    </section>
    
    <section class="main-section">
        <div class="container">
            <div class="section-header fade-in">
                <h2 class="section-title">Nuestras Memorias Doradas</h2>
                <p class="section-description">Cada imagen cuenta una historia, cada momento es una promesa de eternidad.</p>
            </div>
            
            <div class="carousel fade-in">
                                    <div class="image-container active" style="background-image: url('https://dedicapag.com/es/PagDiaFlorAmarilla/Uploads/68cf77803976b_IMG_2224.heic');">
                        <img src="https://dedicapag.com/es/PagDiaFlorAmarilla/Uploads/68cf77803976b_IMG_2224.heic" alt="Momento dorado 1">
                    </div>
                                    <div class="image-container " style="background-image: url('https://dedicapag.com/es/PagDiaFlorAmarilla/Uploads/68cf77803a111_IMG_1771.JPG');">
                        <img src="https://dedicapag.com/es/PagDiaFlorAmarilla/Uploads/68cf77803a111_IMG_1771.JPG" alt="Momento dorado 2">
                    </div>
                                    <div class="image-container " style="background-image: url('https://dedicapag.com/es/PagDiaFlorAmarilla/Uploads/68cf77803a2f1_IMG_2475.jpg');">
                        <img src="https://dedicapag.com/es/PagDiaFlorAmarilla/Uploads/68cf77803a2f1_IMG_2475.jpg" alt="Momento dorado 3">
                    </div>
                                <div class="carousel-nav">
                    <button id="prev-slide">‚Äπ</button>
                    <button id="next-slide">‚Ä∫</button>
                </div>
            </div>
        </div>
        
        <div class="container">
            <div style="text-align: center;">
                <button class="magic-button fade-in" id="openLetterBtn">
                    Abrir mi coraz√≥n                </button>
            </div>
        </div>
    </section>
    
    <div id="letterOverlay">
        <div class="message-content">
            <button class="close-message" id="closeLetterBtn">√ó</button>
            <h2>Para el amor de mi vida</h2>
            <div id="typewriterText">
                <!-- Letter content loaded via JavaScript -->
            </div>
            <div class="signature">
                Con amor infinito e inquebrantable,<br>
                Para siempre tuyo ‚ú®
            </div>
        </div>
    </div>
    
   

    <script>
        let typewriterTimeout = null;
        let isMobile = /Mobi|Android/i.test(navigator.userAgent);
        let _savedScrollY = 0;
        let _savedBodyPosition = '';
        let _savedBodyTop = '';
        let _savedBodyWidth = '';
        let _savedBodyOverflow = '';
        let _savedHtmlOverflow = '';
        let _savedBodyTransform = null;
        let _savedBodyPaddingRight = '';

        function bodyHasTransform() {
            const cs = getComputedStyle(document.body);
            const t = cs.transform || cs.webkitTransform || '';
            return t && t !== 'none' && t !== 'matrix(1, 0, 0, 1, 0, 0)';
        }

        function typeLine(lineElement, text, speed = 20, onDone) {
            const textSpan = lineElement.querySelector('.text');
            const cursor = lineElement.querySelector('.cursor');
            const typewriterContainer = document.getElementById('typewriterText');
            textSpan.textContent = '';
            lineElement.classList.add('active');
            let index = 0;

            function typeChar() {
                if (index < text.length) {
                    textSpan.textContent += text.charAt(index);
                    index++;
                    typewriterContainer.scrollTo({
                        top: typewriterContainer.scrollHeight,
                        behavior: 'smooth'
                    });
                    typewriterTimeout = setTimeout(typeChar, speed);
                } else {
                    cursor.style.display = 'none';
                    typewriterContainer.scrollTo({
                        top: typewriterContainer.scrollHeight,
                        behavior: 'smooth'
                    });
                    if (onDone) onDone();
                }
            }

            cursor.style.display = 'inline-block';
            typeChar();
        }

        (function moveOverlayToHtml() {
            const overlay = document.getElementById('letterOverlay');
            if (!overlay) return;
            if (overlay.parentNode !== document.documentElement) {
                document.documentElement.appendChild(overlay);
            }
        })();

        function openLetterModal() {
            const overlay = document.getElementById('letterOverlay');
            if (!overlay) return;

            _savedScrollY = window.pageYOffset;
            const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;

            _savedBodyPosition = document.body.style.position;
            _savedBodyTop = document.body.style.top;
            _savedBodyWidth = document.body.style.width;
            _savedBodyOverflow = document.body.style.overflow;
            _savedHtmlOverflow = document.documentElement.style.overflow;
            _savedBodyPaddingRight = document.body.style.paddingRight;

            if (bodyHasTransform()) {
                _savedBodyTransform = document.body.style.transform;
                document.body.style.transform = 'none';
            }

            document.body.style.position = 'relative';
            document.body.style.width = '100%';
            document.body.style.overflow = 'hidden';
            document.documentElement.style.overflow = 'hidden';
            document.body.style.paddingRight = `${scrollbarWidth}px`;

            overlay.classList.add('show');

            const typewriterText = document.getElementById('typewriterText');
            typewriterText.innerHTML = '';

            const letterContent = "En este d\u00eda donde el mundo se viste de oro y los girasoles susurran secretos al viento, quiero que sepas que eres mucho m\u00e1s que mi inspiraci\u00f3n: eres mi hogar, mi refugio, mi eterna primavera.";
            const texts = letterContent.split('\n').filter(line => line.trim() !== '');

            if (typewriterTimeout) {
                clearTimeout(typewriterTimeout);
                typewriterTimeout = null;
            }

            texts.forEach(() => {
                const line = document.createElement('span');
                line.classList.add('line');
                line.innerHTML = '<span class="text"></span><span class="cursor" style="display: inline-block; width: 2px; height: 1em; background: var(--secondary-gold); margin-left: 2px; vertical-align: middle; animation: blinkCursor 0.7s step-end infinite;"></span>';
                typewriterText.appendChild(line);
                typewriterText.appendChild(document.createElement('br'));
            });

            const lines = typewriterText.querySelectorAll('.line');

            function typeNextLine(index) {
                if (index < lines.length && index < texts.length) {
                    typeLine(lines[index], texts[index], 30, () => {
                        typeNextLine(index + 1);
                    });
                } else {
                    lines.forEach(line => line.querySelector('.cursor').style.display = 'none');
                }
            }

            typeNextLine(0);
        }

        function closeLetterModal() {
            const overlay = document.getElementById('letterOverlay');
            const typewriterText = document.getElementById('typewriterText');

            if (typewriterTimeout) {
                clearTimeout(typewriterTimeout);
                typewriterTimeout = null;
            }

            typewriterText.innerHTML = '';

            overlay.classList.remove('show');

            document.body.style.position = _savedBodyPosition;
            document.body.style.top = _savedBodyTop;
            document.body.style.width = _savedBodyWidth;
            document.body.style.overflow = _savedBodyOverflow;
            document.documentElement.style.overflow = _savedHtmlOverflow;
            document.body.style.paddingRight = _savedBodyPaddingRight;

            if (_savedBodyTransform !== null) {
                document.body.style.transform = _savedBodyTransform;
                _savedBodyTransform = null;
            }

            window.scrollTo(0, _savedScrollY);
        }

        const style = document.createElement('style');
        style.textContent = `
            @keyframes blinkCursor {
                50% { opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        document.getElementById('openLetterBtn').addEventListener('click', openLetterModal);

        document.getElementById('closeLetterBtn').addEventListener('click', closeLetterModal);

        window.onclick = function(event) {
            const overlay = document.getElementById('letterOverlay');
            if (event.target === overlay) {
                closeLetterModal();
            }
        };

        const slideElements = document.querySelectorAll('.carousel .image-container');
        const prevButton = document.getElementById('prev-slide');
        const nextButton = document.getElementById('next-slide');

        let currentSlide = 0;
        const totalSlides = slideElements.length;

        function showSlide(index) {
            if (index >= totalSlides) index = 0;
            else if (index < 0) index = totalSlides - 1;

            slideElements[currentSlide].classList.remove('active');
            slideElements[currentSlide].style.transform = 'translateX(-100%)';

            currentSlide = index;
            slideElements[currentSlide].classList.add('active');
            slideElements[currentSlide].style.transform = 'translateX(0)';
        }

        if (totalSlides > 0) {
            prevButton.addEventListener('click', () => showSlide(currentSlide - 1));
            nextButton.addEventListener('click', () => showSlide(currentSlide + 1));
            slideElements[0].classList.add('active');
            setInterval(() => showSlide(currentSlide + 1), 5000);
        }

        function initParticleSystem() {
            const system = document.getElementById('particleSystem');
            const interval = isMobile ? 1500 : 1200;
            setInterval(() => {
                const particle = document.createElement('div');
                particle.className = Math.random() > 0.7 ? 'particle large' : 'particle';
                particle.style.left = (Math.random() * 98 + 1) + '%';
                particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
                particle.style.animationDelay = Math.random() * 2 + 's';
                system.appendChild(particle);
                
                setTimeout(() => particle.remove(), 20000);
            }, interval);
        }
        
        function initScrollAnimations() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('visible');
                });
            }, { threshold: 0.1 });
            
            document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
        }
        
        function initParallax() {
            window.addEventListener('scroll', () => {
                const scrolled = window.pageYOffset;
                const heroSection = document.querySelector('.hero-section');
                if (heroSection) heroSection.style.transform = `translateY(${scrolled * 0.5}px)`;
            });
        }
        
        function initMagicCursor() {
            if (isMobile) return;
            const cursor = document.createElement('div');
            cursor.style.cssText = `
                position: fixed;
                width: 20px;
                height: 20px;
                background: radial-gradient(circle, var(--secondary-gold) 0%, transparent 70%);
                border-radius: 50%;
                pointer-events: none;
                z-index: 9999;
                opacity: 0;
                transition: all 0.3s ease;
                transform: translate(-50%, -50%);
            `;
            document.body.appendChild(cursor);
            
            document.addEventListener('mousemove', (e) => {
                cursor.style.left = e.clientX + 'px';
                cursor.style.top = e.clientY + 'px';
                cursor.style.opacity = '0.6';
            });
            
            document.addEventListener('mouseenter', () => cursor.style.opacity = '0.6');
            document.addEventListener('mouseleave', () => cursor.style.opacity = '0');
        }
        
        function createVisualRhythm() {
            if (isMobile) return;
            setInterval(() => {
                const elements = document.querySelectorAll('.hero-title, .section-title');
                elements.forEach(el => {
                    el.style.filter = 'brightness(1.2) saturate(1.1)';
                    setTimeout(() => el.style.filter = 'brightness(1) saturate(1)', 200);
                });
            }, 4000);
        }
        
        function createFloatingFlowers() {
            const flowers = ['üåª','üåº','üå∫','üå∏','üíê','üå∑'];
            const interval = isMobile ? 3000 : 2500;
            const durationMin = isMobile ? 10 : 12;
            const durationMax = isMobile ? 16 : 20;
            const initialBurst = isMobile ? 3 : 9;

            if (!document.getElementById('floatUpKeyframes')) {
                const style = document.createElement('style');
                style.id = 'floatUpKeyframes';
                style.textContent = `
                    @keyframes floatUp {
                        0% { transform: translateY(0) rotate(0deg); opacity: 0; }
                        10% { opacity: 0.8; }
                        90% { opacity: 0.8; }
                        100% { transform: translateY(-120vh) rotate(360deg); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }

            function spawnFlower(startVh) {
                const flower = document.createElement('div');
                flower.className = 'floating-flower';
                flower.textContent = flowers[Math.floor(Math.random() * flowers.length)];
                const size = Math.random() * 20 + 15;
                const left = Math.random() * 98 + 1;
                const duration = Math.random() * (durationMax - durationMin) + durationMin;

                flower.style.cssText = `
                    position: fixed;
                    font-size: ${size}px;
                    left: ${left}%;
                    top: ${startVh}vh;
                    pointer-events: none;
                    z-index: 2;
                    opacity: 0.8;
                    animation: floatUp ${duration}s linear forwards;
                    will-change: transform, opacity;
                `;

                document.body.appendChild(flower);

                setTimeout(() => {
                    flower.remove();
                }, (duration + 0.5) * 1000);
            }

            for (let i = 0; i < initialBurst; i++) {
                const startVh = Math.random() * 35 + 60;
                setTimeout(() => spawnFlower(startVh), i * 120);
            }

            const intervalId = setInterval(() => {
                const startVh = Math.random() * 35 + 60;
                spawnFlower(startVh);
            }, interval);

            createFloatingFlowers._intervalId = intervalId;
        }
        
        function createDynamicBackground() {
            if (isMobile) return;
            const canvas = document.querySelector('.background-canvas');
            let hue = 45;
            const updateBg = () => {
                hue = (hue + 1) % 60;
                canvas.style.background = `
                    radial-gradient(ellipse at top left, hsla(${hue}, 70%, 50%, 0.15) 0%, transparent 50%),
                    radial-gradient(ellipse at bottom right, hsla(${hue + 10}, 80%, 60%, 0.1) 0%, transparent 50%),
                    radial-gradient(ellipse at center, rgba(26, 26, 26, 0.9) 0%, #0a0a0a 100%)
                `;
                requestAnimationFrame(updateBg);
            };
            requestAnimationFrame(updateBg);
        }
        
        window.addEventListener('load', () => {
            initParticleSystem();
            initScrollAnimations();
            initParallax();
            initMagicCursor();
            createVisualRhythm();
            createFloatingFlowers();
            createDynamicBackground();
            
            setTimeout(() => {
                document.body.style.opacity = '1';
                document.body.style.transform = 'scale(1)';
            }, 100);
        });
        
        document.body.style.opacity = '0.95';
        document.body.style.transform = 'scale(0.98)';
        document.body.style.transition = 'all 1s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
        
        const cleanupInterval = setInterval(() => {
            document.querySelectorAll('.particle').forEach(p => {
                if (!p.getAnimations().length) p.remove();
            });
            
            document.querySelectorAll('[style*="floatUp"]').forEach(f => {
                if (!f.getAnimations().length) f.remove();
            });
        }, 10000);

        window.addEventListener('beforeunload', () => {
            clearInterval(cleanupInterval);
            if (typewriterTimeout) clearTimeout(typewriterTimeout);
        });
        window.addEventListener('beforeunload', () => {
            if (createFloatingFlowers._intervalId) clearInterval(createFloatingFlowers._intervalId);
        });

        function setupMusicControls() {
            const music = document.getElementById("backgroundMusic");
            const musicBtn = document.getElementById("musicBtn");
            const playIcon = document.getElementById("playIcon");
            const pauseIcon = document.getElementById("pauseIcon");
            const volumeSlider = document.getElementById("volumeSlider");
            const volumeControl = document.getElementById("volumeControl");

            if (!music || !musicBtn || !volumeSlider || !volumeControl) {
                console.error('Music or control elements not found');
                return;
            }

            music.volume = volumeSlider.value;

            music.load();
            music.currentTime = 0;
            music.play().then(() => {
                console.log('Autoplay successful at:', music.currentTime);
                playIcon.style.display = 'none';
                pauseIcon.style.display = 'inline-block';
            }).catch(error => {
                console.warn('Autoplay blocked:', error.message);
            });

            function toggleMusic() {
                if (music.paused) {
                    music.play().then(() => {
                        console.log('Music playing at:', music.currentTime);
                        playIcon.style.display = 'none';
                        pauseIcon.style.display = 'inline-block';
                    }).catch(error => {
                        console.error('Error playing audio:', error.message);
                    });
                } else {
                    music.pause();
                    console.log('Music paused at:', music.currentTime);
                    playIcon.style.display = 'inline-block';
                    pauseIcon.style.display = 'none';
                }
            }

            musicBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleMusic();
                if (!volumeControl.classList.contains('visible')) {
                    volumeControl.classList.add('visible');
                    clearTimeout(hideVolumeTimeout);
                    hideVolumeTimeout = setTimeout(() => volumeControl.classList.remove('visible'), 2000);
                } else {
                    volumeControl.classList.remove('visible');
                }
            });

            let hideVolumeTimeout = null;
            volumeSlider.addEventListener('input', (e) => {
                music.volume = e.target.value;
                console.log('Volume set to:', music.volume);
                clearTimeout(hideVolumeTimeout);
                volumeControl.classList.add('visible');
            });

            volumeSlider.addEventListener('change', () => {
                hideVolumeTimeout = setTimeout(() => volumeControl.classList.remove('visible'), 2000);
            });

            volumeControl.addEventListener('mouseenter', () => clearTimeout(hideVolumeTimeout));
            volumeControl.addEventListener('mouseleave', () => {
                hideVolumeTimeout = setTimeout(() => volumeControl.classList.remove('visible'), 2000);
            });

            volumeSlider.addEventListener('touchstart', (e) => {
                e.stopPropagation();
                clearTimeout(hideVolumeTimeout);
            });
            volumeSlider.addEventListener('touchend', () => {
                hideVolumeTimeout = setTimeout(() => volumeControl.classList.remove('visible'), 2000);
            });

            document.addEventListener('click', (e) => {
                if (!volumeControl.contains(e.target) && !musicBtn.contains(e.target)) {
                    volumeControl.classList.remove('visible');
                    clearTimeout(hideVolumeTimeout);
                }
            });

            music.addEventListener('loadeddata', () => console.log('Audio data loaded'));
            music.addEventListener('error', (e) => console.error('Audio error:', e.message));
            music.addEventListener('play', () => console.log('Music play event'));
            music.addEventListener('pause', () => console.log('Music pause event'));
        }

        setupMusicControls();
        /* ===== Garantizar que .music-control quede siempre visible y por encima del overlay ===== */
(function keepMusicControlOnTop(){
    const mc = document.querySelector('.music-control');
    if (!mc) return;

    // Mover al ra√≠z del documento (evita que transform en body lo afecte)
    try {
        if (mc.parentNode !== document.documentElement) {
            document.documentElement.appendChild(mc);
        }
    } catch(e) {
        console.warn('No se pudo mover .music-control:', e);
    }

  
    // Asegurar visibilidad si aparece el overlay (letterOverlay)
    const overlay = document.getElementById('letterOverlay');
    if (overlay) {
        // Si el overlay tiene z-index alto, ponemos el control por encima
        const ensureZ = () => {
            const oz = parseInt(window.getComputedStyle(overlay).zIndex || 0, 10) || 0;
            mc.style.zIndex = (oz + 1).toString();
        };
        ensureZ();

        // Observamos cambios en el overlay por si lo muestran/ocultan o cambian z-index
        const obs = new MutationObserver(ensureZ);
        obs.observe(overlay, { attributes: true, attributeFilter: ['style', 'class'] });

        // limpiar al unload
        window.addEventListener('beforeunload', () => obs.disconnect());
    }

    // Reaplicar en resize (robustez)
    window.addEventListener('resize', () => {
        mc.style.position = 'fixed';
        mc.style.transform = 'none';
    });
})();

    </script>
</body>
</html>
